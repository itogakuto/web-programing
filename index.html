<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãŸã‚“ã¼ãƒ¡ãƒ¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      background: #f5f7f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    .hero {
      width: 100%;
      min-height: 200px;
      background: url('image117.jpg') center/cover no-repeat;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: white;
      font-size: 2em;
      font-weight: bold;
      text-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    .container {
      padding: 20px;
    }
    section {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    h2 {
      margin-top: 0;
      color: #446;
    }
    input, select, textarea {
      padding: 10px;
      margin: 6px 6px 6px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    textarea {
      width: 100%;
      resize: vertical;
      margin-bottom: 10px;
    }
    #photo-preview img {
      max-width: 100px;
      margin-top: 10px;
      display: block;
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 6px;
      background: #4CAF50;
      color: white;
      font-size: 1em;
      cursor: pointer;
      margin-right: 6px;
    }
    button:hover {
      background: #45a049;
    }
    .cancel-btn {
      background: #bbb;
    }
    .cancel-btn:hover {
      background: #999;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      margin-bottom: 10px;
      font-size: 1em;
    }
    .delete-btn {
      margin-left: 10px;
      color: red;
      cursor: pointer;
      background: none;
      border: none;
      font-size: 1em;
    }
    .modal-bg {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .modal {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.2);
      min-width: 300px;
      max-width: 90vw;
    }
    /* ã‚«ãƒ¡ãƒ©ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ */
    #cameraStream {
      display: none;
      width: 100%;
      max-width: 300px;
      margin-top: 10px;
      border-radius: 6px;
    }
    #capture-btn {
      display: none;
    }
  </style>
</head>
<body>
  <div class="hero">ãŸã‚“ã¼ãƒ¡ãƒ¢</div>
  <div class="container">
    <!-- ç”°æ¤ãˆæ—¥å…¥åŠ› -->
    <section>
      <h2>ç”°æ¤ãˆæ—¥ã‚’è¨­å®š</h2>
      <input type="date" id="planting-date">
      <button onclick="updateRoutineTasks()">è¨­å®š</button>
    </section>

    <!-- æ¯æ—¥ã®ä½œæ¥­ï¼ˆãƒ«ãƒ¼ãƒãƒ³ã‚¿ã‚¹ã‚¯ï¼‰ -->
    <section>
      <h2>æ¯æ—¥ã®ä½œæ¥­</h2>
      <ul id="routine-tasks">
        <li><input type="checkbox"> æ°´ä½ç¢ºèªï¼ˆè¨­å®šã—ã¦ãã ã•ã„ï¼‰</li>
        <li><input type="checkbox"> å‡ºå£ã®æ°´æ¼ã‚Œãƒã‚§ãƒƒã‚¯</li>
        <li><input type="checkbox"> åœ°é¢ã®éœ²å‡ºç¢ºèª</li>
        <li><input type="checkbox"> è‘‰ã®ç•°å¸¸ãƒã‚§ãƒƒã‚¯ï¼ˆæ¯ã‚Œï¼å¤‰è‰²ï¼æ–‘ç‚¹ï¼‰</li>
      </ul>
      <!-- å‚™è€ƒå…¥åŠ› -->
      <h3>å‚™è€ƒï¼ˆä»»æ„ï¼‰</h3>
      <textarea id="remarks-text" rows="4" placeholder="ä»Šæ—¥ã®æ§˜å­ã‚’è¨˜è¿°..."></textarea>
      <!-- ç”»åƒè¿½åŠ ãƒœã‚¿ãƒ³ -->
      <label for="remarks-photo" style="cursor:pointer;">ç”»åƒã‚’è¿½åŠ </label>
      <input type="file" id="remarks-photo" accept="image/*" style="display:none;">
      <!-- ã‚«ãƒ¡ãƒ©èµ·å‹•ãƒœã‚¿ãƒ³ -->
      <button type="button" id="open-camera">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•</button>
      <video id="cameraStream" autoplay></video>
      <button type="button" id="capture-btn">æ’®å½±</button>
      <canvas id="snapshot" style="display:none;"></canvas>
      <div id="photo-preview"></div>
      <div style="margin-top:10px;">
        <button type="button" onclick="saveRemarks()">ä¿å­˜</button>
        <button type="button" class="cancel-btn" onclick="clearRemarks()">ã‚¯ãƒªã‚¢</button>
      </div>
    </section>

    <!-- ä»Šå¾Œã®äºˆå®šï¼ˆã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¹ã‚¯ï¼‰ -->
    <section>
      <h2>ä»Šå¾Œã®äºˆå®š</h2>
      <ul id="event-tasks"></ul>
      <button onclick="openModal()">äºˆå®šã‚’è¿½åŠ </button>
    </section>
  </div>

  <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal-bg" id="modalBg">
    <div class="modal">
      <h3>äºˆå®šã®è©³ç´°</h3>
      <input type="text" id="event-text" placeholder="ä½œæ¥­å">
      <input type="date" id="event-date">
      <input type="time" id="start-time">
      <input type="time" id="end-time">
      <select id="participants">
        <option value="">å‚åŠ è€…ã‚’é¸æŠ</option>
        <option value="ä½è—¤">ä½è—¤</option>
        <option value="ç”°ä¸­">ç”°ä¸­</option>
        <option value="éˆ´æœ¨">éˆ´æœ¨</option>
      </select>
      <input type="text" id="new-participant" placeholder="æ–°ã—ã„å‚åŠ è€…å">
      <button type="button" onclick="addParticipant()">ï¼‹è¿½åŠ </button>
      <div style="margin-top: 10px;">
        <button onclick="submitEvent()">ç¢ºèª</button>
        <button class="cancel-btn" onclick="closeModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
      </div>
    </div>
  </div>

  <script>
    const eventTasks = document.getElementById('event-tasks');
    const modalBg = document.getElementById('modalBg');
    const remarksText = document.getElementById('remarks-text');
    const remarksPhoto = document.getElementById('remarks-photo');
    const photoPreview = document.getElementById('photo-preview');
    const openCameraBtn = document.getElementById('open-camera');
    const video = document.getElementById('cameraStream');
    const captureBtn = document.getElementById('capture-btn');
    let stream;

    // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    remarksPhoto.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(ev) {
          photoPreview.innerHTML = `<img src="${ev.target.result}" alt="å‚™è€ƒå†™çœŸ">`;
        };
        reader.readAsDataURL(file);
      }
    });

    // ã‚«ãƒ¡ãƒ©èµ·å‹•ï¼ˆåˆæœŸã¯å¤–ã‚«ãƒ¡ãƒ©ï¼‰
    openCameraBtn.addEventListener('click', async () => {
      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        return alert('ã‚«ãƒ¡ãƒ©ã‚’ä½¿ç”¨ã§ãã¾ã›ã‚“');
      }
      // èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’å„ªå…ˆ
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: 'environment' } } });
      video.srcObject = stream;
      video.style.display = 'block';
      captureBtn.style.display = 'inline-block';
    });

    // æ’®å½±
    captureBtn.addEventListener('click', () => {
      const canvas = document.getElementById('snapshot');
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);
      const dataUrl = canvas.toDataURL('image/png');
      photoPreview.innerHTML = `<img src="${dataUrl}" alt="æ’®å½±ç”»åƒ">`;
      // ã‚¹ãƒˆãƒªãƒ¼ãƒ åœæ­¢
      stream.getTracks().forEach(track => track.stop());
      video.style.display = 'none';
      captureBtn.style.display = 'none';
    });

    function saveRemarks() {
      alert('å‚™è€ƒã‚’ä¿å­˜ã—ã¾ã—ãŸ');
    }

    function clearRemarks() {
      remarksText.value = '';
      remarksPhoto.value = '';
      photoPreview.innerHTML = '';
    }

    function openModal() {
      modalBg.style.display = 'flex';
    }

    function closeModal() {
      modalBg.style.display = 'none';
      document.getElementById('event-text').value = '';
      document.getElementById('event-date').value = '';
      document.getElementById('start-time').value = '';
      document.getElementById('end-time').value = '';
      document.getElementById('participants').value = '';
    }

    function submitEvent() {
      const task = document.getElementById('event-text').value.trim();
      const date = document.getElementById('event-date').value;
      const start = document.getElementById('start-time').value;
      const end = document.getElementById('end-time').value;
      const participant = document.getElementById('participants').value;
      if (task && date && start && end && participant) {
        addEventTask(task, date, start, end, participant);
        closeModal();
      } else {
        alert('ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
      }
    }

    function addEventTask(task, date, start, end, participant) {
      const li = document.createElement('li');
      li.innerHTML = `ğŸ•’ ${start}ã€œ${end} ï½œ ğŸ‘¥ ${participant} ï½œ ${task}ï¼ˆ${date}ï¼‰ <button class="delete-btn" onclick="deleteTask(this)">å‰Šé™¤</button>`;
      eventTasks.appendChild(li);
    }

    function deleteTask(button) {
      const li = button.parentElement;
      li.remove();
    }

    function addParticipant() {
      const input = document.getElementById('new-participant');
      const name = input.value.trim();
      if (name) {
        const option = document.createElement('option');
        option.value = name;
        option.textContent = name;
        document.getElementById('participants').appendChild(option);
        input.value = '';
      }
    }

    function updateRoutineTasks() {
      const plantingDateInput = document.getElementById('planting-date');
      const dateStr = plantingDateInput.value;
      if (!dateStr) return alert('ç”°æ¤ãˆæ—¥ã‚’é¸ã‚“ã§ãã ã•ã„');
      const plantingDate = new Date(dateStr);
      const today = new Date();
      const diffDays = Math.floor((today - plantingDate) / (1000 * 60 * 60 * 24));

      let waterLevelText = '';
      if (diffDays < 0) {
        waterLevelText = 'æœªå®šç¾©ï¼ˆæœªæ¥ã®æ—¥ä»˜ã§ã™ï¼‰';
      } else if (diffDays <= 5) {
        waterLevelText = '2ã€œ3cmï¼ˆç”°æ¤ãˆã€œ5æ—¥ç›®ï¼‰';
      } else if (diffDays <= 14) {
        waterLevelText = '3ã€œ5cmï¼ˆ5æ—¥ç›®ã€œ2é€±é–“ï¼‰';
      } else {
        waterLevelText = 'ç®¡ç†è€…åˆ¤æ–­ï¼ˆæˆé•·é€²è¡Œä¸­ï¼‰';
      }

      const routineList = document.getElementById('routine-tasks');
      const items = routineList.getElementsByTagName('li');
      if (items.length > 0) {
        items[0].innerHTML = `<input type="checkbox"> æ°´ä½ç¢ºèªï¼ˆ${waterLevelText}ï¼‰`;
      }
    }
  </script>
</body>
</html>
